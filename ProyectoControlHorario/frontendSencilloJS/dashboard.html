<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Control Horario</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">üïê Control Horario</div>
        <div class="nav-user" id="navUser">Cargando...</div>
        <button class="btn btn-danger btn-sm" onclick="cerrarSesion()">Cerrar Sesi√≥n</button>
    </nav>
    
    <div class="container dashboard">
        <h1>Panel de Control</h1>
        <p class="subtitle" id="rolSubtitle">Selecciona una acci√≥n</p>
        
        <div class="dashboard-grid">
            <!-- FICHAR - Todos excepto Administrador y Auditor -->
            <a href="fichar.html" class="dashboard-card" id="cardFichar">
                <span class="card-icon">‚è∞</span>
                <h3>Fichar</h3>
                <p>Registra tu entrada o salida</p>
            </a>
            
            <!-- VER FICHAJES - Todos excepto Administrador y Auditor -->
            <a href="fichajes.html" class="dashboard-card" id="cardFichajes">
                <span class="card-icon">üìã</span>
                <h3>Ver Fichajes</h3>
                <p>Consulta tu historial</p>
            </a>
            
            <!-- SOLICITAR EDICI√ìN - Empleado y Supervisor -->
            <a href="editar.html" class="dashboard-card" id="cardEditar">
                <span class="card-icon">‚úèÔ∏è</span>
                <h3>Solicitar Edici√≥n</h3>
                <p>Modifica un fichaje existente</p>
            </a>
            
            <!-- APROBAR SOLICITUDES - Solo Supervisor -->
            <a href="aprobar-solicitudes.html" class="dashboard-card" id="cardAprobar" style="display: none;">
                <span class="card-icon">‚úÖ</span>
                <h3>Aprobar Solicitudes</h3>
                <p>Revisar ediciones pendientes</p>
            </a>
            
            <!-- VERIFICAR INTEGRIDAD - Solo Administrador y Auditor -->
            <a href="verificar-integridad.html" class="dashboard-card" id="cardVerificar" style="display: none;">
                <span class="card-icon">üîê</span>
                <h3>Verificar Integridad</h3>
                <p>Comprobar cadena blockchain</p>
            </a>
            
            <!-- REGISTRAR USUARIOS - Solo Administrador -->
            <a href="registro.html" class="dashboard-card" id="cardRegistro" style="display: none;">
                <span class="card-icon">üë§</span>
                <h3>Registrar Usuario</h3>
                <p>Crear nuevos usuarios</p>
            </a>
            
            <a href="index.html" class="dashboard-card secondary" onclick="cerrarSesion()">
                <span class="card-icon">üö™</span>
                <h3>Salir</h3>
                <p>Cerrar sesi√≥n</p>
            </a>
        </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        // Verificar que el usuario est√© autenticado
        if (!verificarSesion()) {
            window.location.href = 'login.html';
        }
        
        // Obtener datos del token
        const datos = obtenerDatosToken();
        
        if (datos) {
            // Mostrar nombre de usuario y rol
            document.getElementById('navUser').textContent = `${datos.username} (${datos.rol})`;
            document.getElementById('rolSubtitle').textContent = `Rol: ${datos.rol} ${datos.departamento ? '- Departamento: ' + datos.departamento : ''}`;
            
            const rol = datos.rol.toLowerCase().trim();
            
            console.log('üîç Rol detectado:', datos.rol);
            console.log('üîç Rol normalizado:', rol);
            
            // Ocultar/Mostrar tarjetas seg√∫n el rol
            const cardFichar = document.getElementById('cardFichar');
            const cardFichajes = document.getElementById('cardFichajes');
            const cardEditar = document.getElementById('cardEditar');
            const cardAprobar = document.getElementById('cardAprobar');
            const cardVerificar = document.getElementById('cardVerificar');
            const cardRegistro = document.getElementById('cardRegistro');
            
            // Por defecto, ocultar todas las tarjetas espec√≠ficas
            cardFichar.style.display = 'none';
            cardFichajes.style.display = 'none';
            cardEditar.style.display = 'none';
            cardAprobar.style.display = 'none';
            cardVerificar.style.display = 'none';
            cardRegistro.style.display = 'none';
            
            // Mostrar seg√∫n el rol
            switch(rol) {
                case 'administrador':
                    // El administrador solo puede registrar usuarios y verificar integridad
                    cardVerificar.style.display = 'block';
                    cardRegistro.style.display = 'block';
                    break;
                    
                case 'auditor':
                    // El auditor solo puede verificar integridad
                    cardVerificar.style.display = 'block';
                    break;
                    
                case 'supervisor':
                    // El supervisor puede hacer todo excepto registrar usuarios
                    cardFichar.style.display = 'block';
                    cardFichajes.style.display = 'block';
                    cardEditar.style.display = 'block';
                    cardAprobar.style.display = 'block';
                    break;
                    
                case 'empleado':
                    // El empleado puede fichar, ver fichajes y solicitar ediciones
                    cardFichar.style.display = 'block';
                    cardFichajes.style.display = 'block';
                    cardEditar.style.display = 'block';
                    break;
                    
                default:
                    console.warn('‚ö†Ô∏è Rol no reconocido:', rol);
            }
        } else {
            document.getElementById('navUser').textContent = 'Usuario';
            cerrarSesion();
        }
    </script>
</body>
</html>